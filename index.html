<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‰©ä»¶ãƒãƒƒãƒ—</title>

    <!-- iPhone / Android ã‚¢ã‚¤ã‚³ãƒ³å¯¾å¿œ -->
    <link rel="apple-touch-icon" sizes="180x180" href="./logo_512x512.png">
    <link rel="icon" href="./logo_512x512.png">
    <meta name="theme-color" content="#ffffff">

    <!-- PWAå¯¾å¿œãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ -->
    <link rel="manifest" href="./manifest.json">

    <style>
      body {
        margin: 0;
        font-family: sans-serif;
      }
      #map {
        height: calc(100vh - 70px);
        width: 100%;
      }
      .info-window {
        font-size: 1.8rem;
        line-height: 2.2;
        max-width: 320px;
        padding: 12px;
      }
      .info-window strong {
        font-size: 2rem;
        display: block;
        margin-bottom: 8px;
      }
      .info-window a {
        font-size: 1.8rem;
        color: #1a73e8;
        text-decoration: none;
        display: inline-block;
        margin-bottom: 6px;
      }
      .info-window a:hover {
        text-decoration: underline;
      }
      .info-window em {
        font-size: 1.6rem;
        color: #666;
        display: block;
        margin-top: 6px;
      }
      select {
        font-size: 1.4rem;
        padding: 6px;
        width: 100%;
        max-width: 300px;
      }
      label {
        font-size: 1.4rem;
        display: block;
        margin-bottom: 5px;
      }
    </style>

    <script>
      let map;
      let allMarkers = [];

      function initMap() {
         const script = document.createElement('script');
  script.src = "https://script.google.com/macros/s/AKfycbyj9JRN6Wuyzwq92QUeULCcKM9yNwQClzlpnWuYX5MQbwfxbWcUsrzLZik6W9ldgPm5IA/exec?callback=displayMarkers";
  document.body.appendChild(script);
      }

      function displayMarkers(locations) {
        map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: 26.2124, lng: 127.6809 },
          zoom: 10
        });

        const colors = {
          "åœŸåœ°": "http://maps.google.com/mapfiles/ms/icons/red-dot.png",
          "æˆ¸å»ºã¦": "http://maps.google.com/mapfiles/ms/icons/blue-dot.png",
          "ãƒãƒ³ã‚·ãƒ§ãƒ³": "http://maps.google.com/mapfiles/ms/icons/green-dot.png",
          "åç›Šç‰©ä»¶": "http://maps.google.com/mapfiles/ms/icons/yellow-dot.png",
          "è»ç”¨åœ°": "http://maps.google.com/mapfiles/ms/icons/purple-dot.png",
          "å·¥å ´ãƒ»åº—èˆ—": "http://maps.google.com/mapfiles/ms/icons/pink-dot.png",
          "çœŒå¤–ãƒ»é›¢å³¶": "http://maps.google.com/mapfiles/ms/icons/brown-dot.png",
          "ãã®ä»–": "http://maps.google.com/mapfiles/ms/icons/orange-dot.png"
        };

        allMarkers = [];

        locations.forEach(loc => {
          const iconUrl = colors[loc.sheet] || colors["ãã®ä»–"];

          const marker = new google.maps.Marker({
            position: { lat: loc.lat, lng: loc.lng },
            map: map,
            title: loc.name,
            icon: {
              url: iconUrl,
              scaledSize: new google.maps.Size(60, 60)
            }
          });

          const infoWindow = new google.maps.InfoWindow({
            content: `
              <div class="info-window">
                <strong>${loc.name}</strong><br>
                <a href="${loc.pdf}" target="_blank">ğŸ“„ æ¦‚è¦æ›¸</a><br>
      <div>ğŸ’° ä¾¡æ ¼ï¼š${loc.price} ä¸‡å††</div>
      <div>ğŸ“ åªå˜ä¾¡ï¼š${loc.tsubo} ä¸‡å††</div>
      <div>ğŸ‘¨ ç´¹ä»‹å…ƒï¼š${loc.agency}</div>
      <em>${loc.sheet}</em>
              </div>
            `
          });

          marker.addListener('click', () => {
            infoWindow.open(map, marker);
          });

          allMarkers.push({ marker, sheet: loc.sheet });
        });
      }

      function filterMarkers() {
        const selected = document.getElementById("filter").value;

        allMarkers.forEach(({ marker, sheet }) => {
          if (selected === "all" || sheet === selected) {
            marker.setMap(map);
          } else {
            marker.setMap(null);
          }
        });
      }
    </script>
  </head>

  <body onload="initMap()">
    <div class="filter-box" style="padding:10px;background:#f5f5f5">
      <label for="filter">ã‚«ãƒ†ã‚´ãƒªã§çµã‚Šè¾¼ã¿ï¼š</label>
      <select id="filter" onchange="filterMarkers()">
        <option value="all">ã™ã¹ã¦è¡¨ç¤º</option>
        <option value="åœŸåœ°">åœŸåœ°</option>
        <option value="æˆ¸å»ºã¦">æˆ¸å»ºã¦</option>
        <option value="ãƒãƒ³ã‚·ãƒ§ãƒ³">ãƒãƒ³ã‚·ãƒ§ãƒ³</option>
        <option value="åç›Šç‰©ä»¶">åç›Šç‰©ä»¶</option>
        <option value="è»ç”¨åœ°">è»ç”¨åœ°</option>
        <option value="å·¥å ´ãƒ»åº—èˆ—">å·¥å ´ãƒ»åº—èˆ—</option>
        <option value="çœŒå¤–ãƒ»é›¢å³¶">çœŒå¤–ãƒ»é›¢å³¶</option>
      </select>
    </div>
    <div id="map"></div>
    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDA_HvHFLoJO8Iib-ig100cnmP2XKE124E&callback=initMap">
    </script>
  </body>
</html>