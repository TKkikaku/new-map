<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç‰©ä»¶ãƒãƒƒãƒ—</title>
    <link rel="icon" href="./logo_512x512.png" />
    <link rel="manifest" href="./manifest.json" />
    <meta name="theme-color" content="#ffffff" />
    <style>
      body {
        margin: 0;
        font-family: sans-serif;
      }
      #login-box {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
      }
      #map, .filter-box, .city-filter-box {
        display: none;
      }
      #map {
        height: calc(100vh - 140px);
        width: 100%;
      }
      .info-window {
        font-size: 12px;
        line-height: 1.4;
        max-width: 240px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 8px;
      }
      .info-window .info-title {
        font-size: 14px;
        font-weight: bold;
        margin-bottom: 2px;
      }
      .info-window .info-category {
        font-size: 11px;
        color: #666;
        margin-bottom: 6px;
      }
      .info-window .info-link {
        display: inline-block;
        margin: 4px 0;
        color: #1a73e8;
        text-decoration: none;
        font-weight: bold;
        font-size: 12px;
      }
      .info-window .info-line {
        margin: 2px 0;
        font-size: 12px;
      }
      .info-window .info-line span {
        font-weight: normal;
      }
      select {
        font-size: 1.4rem;
        padding: 6px;
        width: 100%;
        max-width: 300px;
      }
      label {
        font-size: 1.4rem;
        display: block;
        margin-bottom: 5px;
      }
    </style>
  </head>

  <body>
    <div id="login-box">
      <h2>ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
      <input type="password" id="passcode-input" placeholder="ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’å…¥åŠ›" />
      <button onclick="checkPasscode()">ãƒ­ã‚°ã‚¤ãƒ³</button>
      <p id="error-message" style="color: red;"></p>
    </div>

    <div class="filter-box" style="padding:10px;background:#f5f5f5">
      <label for="filter">ã‚«ãƒ†ã‚´ãƒªã§çµã‚Šè¾¼ã¿ï¼š</label>
      <select id="filter" onchange="filterMarkers()">
        <option value="all">ã™ã¹ã¦è¡¨ç¤º</option>
        <option value="åœŸåœ°">åœŸåœ°</option>
        <option value="æˆ¸å»ºã¦">æˆ¸å»ºã¦</option>
        <option value="ãƒãƒ³ã‚·ãƒ§ãƒ³">ãƒãƒ³ã‚·ãƒ§ãƒ³</option>
        <option value="åç›Šç‰©ä»¶">åç›Šç‰©ä»¶</option>
        <option value="è»ç”¨åœ°">è»ç”¨åœ°</option>
        <option value="å·¥å ´ãƒ»åº—èˆ—">å·¥å ´ãƒ»åº—èˆ—</option>
        <option value="çœŒå¤–ãƒ»é›¢å³¶">çœŒå¤–ãƒ»é›¢å³¶</option>
        <option value="ååˆº">ååˆº</option>
      </select>
    </div>

    <div class="city-filter-box" style="padding:10px;background:#f0f0f0">
      <label for="cityFilter">å¸‚åŒºç”ºæ‘ã§çµã‚Šè¾¼ã¿ï¼š</label>
      <select id="cityFilter" onchange="filterMarkers()">
        <option value="all">ã™ã¹ã¦è¡¨ç¤º</option>
      </select>
    </div>

    <div id="map"></div>

    <script>
      const CORRECT_PASSCODE = "Tkkikaku1212!";

      function checkPasscode() {
        const input = document.getElementById("passcode-input").value;
        const error = document.getElementById("error-message");
        if (input === CORRECT_PASSCODE) {
          localStorage.setItem("tk_passcode", input);
          document.getElementById("login-box").style.display = "none";
          document.getElementById("map").style.display = "block";
          document.querySelector(".filter-box").style.display = "block";
          document.querySelector(".city-filter-box").style.display = "block";
          initMap();
        } else {
          error.textContent = "ãƒ‘ã‚¹ã‚³ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™";
        }
      }

      window.onload = () => {
        const saved = localStorage.getItem("tk_passcode");
        if (saved === CORRECT_PASSCODE) {
          document.getElementById("login-box").style.display = "none";
          document.getElementById("map").style.display = "block";
          document.querySelector(".filter-box").style.display = "block";
          document.querySelector(".city-filter-box").style.display = "block";
          initMap();
        }
      };

      let map;
      let allMarkers = [];

      function initMap() {
        const script = document.createElement("script");
        script.src = "https://script.google.com/macros/s/AKfycbyj9JRN6Wuyzwq92QUeULCcKM9yNwQClzlpnWuYX5MQbwfxbWcUsrzLZik6W9ldgPm5IA/exec?callback=displayMarkers";
        document.body.appendChild(script);
      }

      function displayMarkers(locations) {
        map = new google.maps.Map(document.getElementById("map"), {
          center: { lat: 26.2124, lng: 127.6809 },
          zoom: 10,
        });

        const cityOrder = [
          "åè­·å¸‚","æ©ç´æ‘","é‡‘æ­¦ç”º","å®œé‡åº§æ‘","æœ¬éƒ¨ç”º","ä»Šå¸°ä»æ‘","å¤§å®œå‘³æ‘","å›½é ­æ‘","æ±æ‘",
          "æ²–ç¸„å¸‚","ã†ã‚‹ã¾å¸‚","æµ¦æ·»å¸‚","å®œé‡æ¹¾å¸‚","èª­è°·æ‘","å˜‰æ‰‹ç´ç”º","åŒ—è°·ç”º","ä¸­åŸæ‘","è¥¿åŸç”º",
          "é‚£è¦‡å¸‚","è±Šè¦‹åŸå¸‚","ç³¸æº€å¸‚","å—é¢¨åŸç”º","ä¸é‚£åŸç”º","å…«é‡ç€¬ç”º",
          "çŸ³å£å¸‚","å®®å¤å³¶å¸‚","ãã®ä»–"
        ];

        const citySet = new Set();
        const infoWindow = new google.maps.InfoWindow();
        allMarkers = [];

        locations.forEach(loc => {
          const iconUrl = "http://maps.google.com/mapfiles/ms/icons/" +
            (loc.sheet === "ååˆº" ? "orange" :
            loc.sheet === "åœŸåœ°" ? "red" :
            loc.sheet === "æˆ¸å»ºã¦" ? "blue" :
            loc.sheet === "ãƒãƒ³ã‚·ãƒ§ãƒ³" ? "green" :
            loc.sheet === "åç›Šç‰©ä»¶" ? "yellow" :
            loc.sheet === "è»ç”¨åœ°" ? "purple" :
            loc.sheet === "å·¥å ´ãƒ»åº—èˆ—" ? "pink" :
            loc.sheet === "çœŒå¤–ãƒ»é›¢å³¶" ? "brown" : "orange") + "-dot.png";

          const marker = new google.maps.Marker({
            position: { lat: loc.lat, lng: loc.lng },
            map: map,
            title: loc.name,
            icon: {
              url: iconUrl,
              scaledSize: new google.maps.Size(60, 60)
            }
          });

          let content;
          if (loc.sheet === "ååˆº") {
            content = `
              <div class="info-window">
                <div class="info-title">ğŸ“· <br><img src="${loc.image}" style="width:100%;max-width:200px;"></div>
                <div class="info-line">ğŸ‘¨â€ğŸ’¼ ä¼šç¤¾åï¼š<span>${loc.company || ""}</span></div>
                <div class="info-line">ğŸ¢ ä¼šç¤¾ç•ªå·ï¼š<span>${loc.companytel || ""}</span></div>
                <div class="info-line">ğŸ§‘ æ‹…å½“åï¼š<span>${loc.name}</span></div>
                <div class="info-line">ğŸ“› ãƒ•ãƒªã‚¬ãƒŠï¼š<span>${loc.kana || ""}</span></div>
                <div class="info-line">ğŸ“ æ‹…å½“ç•ªå·ï¼š<a href="tel:${loc.tel}">${loc.tel}</a></div>
                <div class="info-line">ğŸ“ å‚™è€ƒï¼š<span>${loc.memo || ""}</span></div>
              </div>
            `;
          } else {
            content = `
              <div class="info-window">
                <div class="info-title">${loc.name}</div>
                <div class="info-category">${loc.sheet}</div>
                <a class="info-link" href="${loc.pdf}" target="_blank">ğŸ“„ æ¦‚è¦æ›¸</a>
                <div class="info-line">ğŸ’° ä¾¡æ ¼ï¼š<span>${loc.price} ä¸‡å††</span></div>
                <div class="info-line">ğŸ“ åªå˜ä¾¡ï¼š<span>${loc.tsubo} ä¸‡å††</span></div>
                <div class="info-line">ğŸ‘¤ ç´¹ä»‹å…ƒï¼š<span>${loc.agency}</span></div>
              </div>
            `;
            if (loc.city) citySet.add(loc.city);
          }

          marker.addListener("click", () => {
            infoWindow.setContent(content);
            infoWindow.open(map, marker);
          });

          allMarkers.push({ marker, sheet: loc.sheet, city: loc.city || "" });
        });

        const citySelect = document.getElementById("cityFilter");
        citySelect.innerHTML = '<option value="all">ã™ã¹ã¦è¡¨ç¤º</option>';
        cityOrder.forEach(city => {
          if (citySet.has(city)) {
            const option = document.createElement("option");
            option.value = city;
            option.textContent = city;
            citySelect.appendChild(option);
          }
        });
      }

      function filterMarkers() {
        const selectedCategory = document.getElementById("filter").value;
        const selectedCity = document.getElementById("cityFilter").value;
        allMarkers.forEach(({ marker, sheet, city }) => {
          const matchCategory = selectedCategory === "all" || sheet === selectedCategory;
          const matchCity = selectedCity === "all" || city === selectedCity;
          marker.setMap(matchCategory && matchCity ? map : null);
        });
      }
    </script>

    <script async defer
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDA_HvHFLoJO8Iib-ig100cnmP2XKE124E&callback=initMap">
    </script>
  </body>
</html>
